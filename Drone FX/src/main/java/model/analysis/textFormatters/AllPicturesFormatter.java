package model.analysis.textFormatters;

import model.analysis.DataAnalyzer;
import model.analysis.ImageQuery;
import model.image.ImageEntry;
import model.location.Location;
import model.species.Species;
import org.apache.commons.io.FilenameUtils;

import java.time.format.DateTimeFormatter;
import java.util.List;

/**
 * The text formatter the "all pictures" file generated by DataAnalyze
 * 
 * @author David Slovikosky
 */
public class AllPicturesFormatter extends TextFormatter
{
	public AllPicturesFormatter(List<ImageEntry> images, DataAnalyzer analysis)
	{
		super(images, analysis);
	}

	/**
	 * <p>
	 * All pictures is a file that contains a list of each species, location, and image file photographed
	 * 
	 * @return Returns a string representing the data in a clean form
	 */
	public String createAllPictures()
	{
		StringBuilder toReturn = new StringBuilder();

		DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy MM dd HH mm ss");

		for (Location location : analysis.getAllImageLocations())
		{
			List<ImageEntry> withLocation = new ImageQuery().locationOnly(location).query(images);
			for (Species species : analysis.getAllImageSpecies())
			{
				List<ImageEntry> withLocationSpecies = new ImageQuery().speciesOnly(species).query(withLocation);
				for (ImageEntry imageEntry : withLocationSpecies)
				{
					toReturn.append(String.format("%-28s %-28s %-28s\n", location.getName(), species.getName(), imageEntry.getDateTaken().format(formatter) + "." + FilenameUtils.getExtension(imageEntry.getFile().toString())));
				}
			}
		}

		if (toReturn.length() > 0)
			toReturn = new StringBuilder(toReturn.substring(0, toReturn.length() - 1));

		return toReturn.toString();
	}
}
